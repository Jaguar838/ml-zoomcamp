## 5.6 –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ–º: Docker

<a href="https://www.youtube.com/watch?v=wAtyYZ6zvAs&list=PL3MmuxUbc_hIhxl5Ji8t4O6lPAOpHaCLR"><img src="images/thumbnail-5-06.jpg"></a>

[–°–ª–∞–π–¥–∏](https://www.slideshare.net/AlexeyGrigorev/ml-zoomcamp-5-model-deployment)

## –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è Docker

–©–æ–± —â–µ –±—ñ–ª—å—à–µ —ñ–∑–æ–ª—é–≤–∞—Ç–∏ –Ω–∞—à –ø—Ä–æ—î–∫—Ç –≤—ñ–¥ —Å–∏—Å—Ç–µ–º–∏, –º–æ–∂–Ω–∞ —Å–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏—Å—è Docker. Docker –¥–æ–∑–≤–æ–ª—è—î —É–ø–∞–∫—É–≤–∞—Ç–∏ –≤–µ—Å—å –ø—Ä–æ—î–∫—Ç —É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—é —Å–∏—Å—Ç–µ–º–æ—é —Ç–∞ –∑–∞–ø—É—Å–∫–∞—Ç–∏ –π–æ–≥–æ –Ω–∞ –±—É–¥—å-—è–∫–æ–º—É –ø—Ä–∏—Å—Ç—Ä–æ—ó. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ Ubuntu 20.4 –Ω–∞ –∫–æ–º–ø'—é—Ç–µ—Ä—ñ –∑ macOS, Windows –∞–±–æ —ñ–Ω—à–æ—é –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω–æ—é —Å–∏—Å—Ç–µ–º–æ—é. <br>
–©–æ–± –ø–æ—á–∞—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ Docker –¥–ª—è –ø—Ä–æ—î–∫—Ç—É –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è –≤—ñ–¥—Ç–æ–∫—É, —Å–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ—Å—è —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è–º–∏ –Ω–∏–∂—á–µ.

### Ubuntu

```bash
sudo apt-get install docker.io
```

–©–æ–± –∑–∞–ø—É—Å–∫–∞—Ç–∏ Docker –±–µ–∑ `sudo`, –¥–æ—Ç—Ä–∏–º—É–π—Ç–µ—Å—å [—Ü–∏—Ö —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π](https://docs.docker.com/engine/install/linux-postinstall/).

### Windows

–©–æ–± –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ Docker, —Å–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ—Å—å —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è–º–∏ –≤—ñ–¥ –ï–Ω–¥—Ä—é –õ–æ–∫–∞ –∑–∞ —Ü–∏–º –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º: https://andrewlock.net/installing-docker-desktop-for-windows/

### MacOS

–°–ª—ñ–¥–∫—É–π—Ç–µ –∑–∞ –∫—Ä–æ–∫–∞–º–∏ –≤ [–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó Docker](https://docs.docker.com/desktop/install/mac-install/).

## –ù–æ—Ç–∞—Ç–∫–∏

- –ö–æ–ª–∏ –ø—Ä–æ—î–∫—Ç —É–ø–∞–∫–æ–≤–∞–Ω–∏–π —É Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –π–æ–≥–æ –º–æ–∂–Ω–∞ –∑–∞–ø—É—Å–∫–∞—Ç–∏ –Ω–∞ –±—É–¥—å-—è–∫–æ–º—É –ø—Ä–∏—Å—Ç—Ä–æ—ó.
- –°–ø–µ—Ä—à—É –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –æ–±—Ä–∞–∑ Docker. –§–∞–π–ª –æ–±—Ä–∞–∑—É Docker –º—ñ—Å—Ç–∏—Ç—å –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –Ω–∞—à–æ–≥–æ –ø—Ä–æ—î–∫—Ç—É. –©–æ–± –∑–Ω–∞–π—Ç–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ Docker-–æ–±—Ä–∞–∑–∏, –º–æ–∂–Ω–∞ –ø—Ä–æ—Å—Ç–æ –∑–¥—ñ–π—Å–Ω–∏—Ç–∏ –ø–æ—à—É–∫ –Ω–∞ [—Å–∞–π—Ç—ñ Docker](https://hub.docker.com/search?type=image).

–û—Å—å –ø—Ä–∏–∫–ª–∞–¥ Dockerfile (–ö–æ–º–µ–Ω—Ç–∞—Ä—ñ –≤ Dockerfile –±—É—Ç–∏ –Ω–µ –ø–æ–≤–∏–Ω–Ω—ñ, —Ç–æ–º—É –≤–∏–¥–∞–ª—ñ—Ç—å —ó—Ö, –∫–æ–ª–∏ –∫–æ–ø—ñ—é—î—Ç–µ):

```docker
# –°–ø–æ—á–∞—Ç–∫—É –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ Python 3.8, slim-–≤–µ—Ä—Å—ñ—è –∑–∞–π–º–∞—î –º–µ–Ω—à–µ –º—ñ—Å—Ü—è
FROM python:3.8.12-slim

# –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É pipenv –≤ Docker
RUN pip install pipenv

# –°—Ç–≤–æ—Ä—é—î–º–æ –≤ Docker –∫–∞—Ç–∞–ª–æ–≥ app —ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –π–æ–≥–æ —è–∫ —Ä–æ–±–æ—á–∏–π –∫–∞—Ç–∞–ª–æ–≥
WORKDIR /app                                                                

# –ö–æ–ø—ñ—é—î–º–æ Pip-—Ñ–∞–π–ª–∏ –≤ –Ω–∞—à —Ä–æ–±–æ—á–∏–π –∫–∞—Ç–∞–ª–æ–≥
COPY ["Pipfile", "Pipfile.lock", "./"]

# –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ pipenv –¥–ª—è –ø—Ä–æ—î–∫—Ç—É —ñ —Ä–æ–∑–≥–æ—Ä—Ç–∞—î–º–æ —ó—Ö
RUN pipenv install --deploy --system

# –ö–æ–ø—ñ—é—î–º–æ –≤—Å—ñ Python-—Ñ–∞–π–ª–∏ —Ç–∞ –º–æ–¥–µ–ª—å —É —Ä–æ–±–æ—á–∏–π –∫–∞—Ç–∞–ª–æ–≥ Docker
COPY ["*.py", "churn-model.bin", "./"]

# –í—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ –ø–æ—Ä—Ç 9696 –¥–ª—è –∑–≤'—è–∑–∫—É –∑ Docker
EXPOSE 9696

# –ü—Ä–∏ –∑–∞–ø—É—Å–∫—É –æ–±—Ä–∞–∑—É Docker –∑–∞–ø—É—Å–∫–∞—î–º–æ –Ω–∞—à –¥–æ–¥–∞—Ç–æ–∫ –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è –≤—ñ–¥—Ç–æ–∫—É
ENTRYPOINT ["gunicorn", "--bind", "0.0.0.0:9696", "churn_serving:app"]
```

–§–ª–∞–≥–∏ `--deploy` —ñ `--system` –≥–∞—Ä–∞–Ω—Ç—É—é—Ç—å, —â–æ –º–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –±–µ–∑ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ–≥–æ –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º —Ü–µ —Ä–æ–±–∏—Ç—å pipenv).

–Ø–∫—â–æ –Ω–µ –¥–æ–¥–∞—Ç–∏ –æ—Å—Ç–∞–Ω–Ω—ñ–π —Ä—è–¥–æ–∫ `ENTRYPOINT`, –≤–∏ –æ–ø–∏–Ω–∏—Ç–µ—Å—å —É Python-—Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ.
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –¥–ª—è entrypoint –º–∏ –∑–∞–ø–∏—Å—É—î–º–æ –∫–æ–º–∞–Ω–¥–∏ –≤ –ø–æ–¥–≤—ñ–π–Ω–∏—Ö –ª–∞–ø–∫–∞—Ö.

–ü—ñ—Å–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è Dockerfile, –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–æ–±—É–¥—É–≤–∞—Ç–∏ –π–æ–≥–æ:

```bash
docker build -t churn-prediction .
```

–©–æ–± –∑–∞–ø—É—Å—Ç–∏—Ç–∏, –≤–∏–∫–æ–Ω–∞–π—Ç–µ –∫–æ–º–∞–Ω–¥—É –Ω–∏–∂—á–µ:

```bash
docker run -it -p 9696:9696 churn-prediction:latest
```

–ü–æ—è—Å–Ω–µ–Ω–Ω—è –ø—Ä–∞–ø–æ—Ä—Ü—ñ–≤:

- `-t`: –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –∑–∞–¥–∞–Ω–Ω—è —ñ–º–µ–Ω—ñ –º—ñ—Ç–∫–∏ "churn-prediction".
- `-it`: —â–æ–± Docker –¥–æ–∑–≤–æ–ª–∏–≤ –Ω–∞–º –¥–æ—Å—Ç—É–ø –¥–æ —Ç–µ—Ä–º—ñ–Ω–∞–ª—É.
- `--rm`: –¥–æ–∑–≤–æ–ª—è—î –≤–∏–¥–∞–ª–∏—Ç–∏ –æ–±—Ä–∞–∑ —ñ–∑ —Å–∏—Å—Ç–µ–º–∏ –ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è.
- `-p`: –¥–ª—è –ø—Ä–∏–≤'—è–∑–∫–∏ –ø–æ—Ä—Ç—É 9696 Docker –¥–æ –ø–æ—Ä—Ç—É 9696 –Ω–∞—à–æ–≥–æ –ø—Ä–∏—Å—Ç—Ä–æ—é (–ø–µ—Ä—à–∏–π 9696 ‚Äî —Ü–µ –ø–æ—Ä—Ç –Ω–∞ –Ω–∞—à–æ–º—É –ø—Ä–∏—Å—Ç—Ä–æ—ó, –¥—Ä—É–≥–∏–π ‚Äî –ø–æ—Ä—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ Docker).
- `--entrypoint=bash`: –ø—ñ—Å–ª—è –∑–∞–ø—É—Å–∫—É Docker –º–∏ –∑–º–æ–∂–µ–º–æ –≤–∑–∞—î–º–æ–¥—ñ—è—Ç–∏ –∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é bash (—è–∫ –∑–∞–∑–≤–∏—á–∞–π —É —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ). –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º `python`.

–í—ñ—Ç–∞—î–º–æ üéâ –í–∏ —Ä–æ–∑–≥–æ—Ä–Ω—É–ª–∏ —Å–≤—ñ–π –¥–æ–¥–∞—Ç–æ–∫ –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ Docker.

<table>
   <tr>
      <td>‚ö†Ô∏è</td>
      <td>
         –¶—ñ –Ω–æ—Ç–∞—Ç–∫–∏ –Ω–∞–ø–∏—Å–∞–Ω—ñ —Å–ø—ñ–ª—å–Ω–æ—Ç–æ—é. <br>
         –Ø–∫—â–æ –≤–∏ –ø–æ–º—ñ—Ç–∏–ª–∏ –ø–æ–º–∏–ª–∫—É, —Å—Ç–≤–æ—Ä—ñ—Ç—å PR –¥–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è.
      </td>
   </tr>
</table>

* [–ù–æ—Ç–∞—Ç–∫–∏ –≤—ñ–¥ Peter Ernicke](https://knowmledge.com/2023/10/14/ml-zoomcamp-2023-deploying-machine-learning-models-part-6/)

## –ù–∞–≤—ñ–≥–∞—Ü—ñ—è

* [–ö—É—Ä—Å Machine Learning Zoomcamp](../)
* [–°–µ—Å—ñ—è 5: –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –º–æ–¥–µ–ª–µ–π –º–∞—à–∏–Ω–Ω–æ–≥–æ –Ω–∞–≤—á–∞–Ω–Ω—è](./)
* –ü–æ–ø–µ—Ä–µ–¥–Ω—è: [–í—ñ—Ä—Ç—É–∞–ª—å–Ω–µ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ Python: Pipenv](05-pipenv.md)
* –ù–∞—Å—Ç—É–ø–Ω–∞: [–†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –≤ —Ö–º–∞—Ä—ñ: AWS Elastic Beanstalk (–Ω–µ–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ)](07-aws-eb.md)
